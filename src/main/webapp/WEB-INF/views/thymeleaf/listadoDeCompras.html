<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Historial de Compras</title>
  <style>
    .ganancia { color: green; font-weight: bold; }
    .perdida { color: red; font-weight: bold; }
    header { margin-bottom: 20px; padding: 10px; border-bottom: 1px solid #ccc; }
  </style>
</head>
<body>

<header>
  <div>
    <label for="cotizacionActual"><strong>Cotizaci&oacute;n Actual (ARS): </strong></label>
    <input type="number" id="cotizacionActual" value="1000" step="0.01" oninput="calcularDiferencias()">
    <small>(Edita este valor para ver ganancias/pérdidas)</small>
  </div>

  <br>

  <div>
    <strong>Filtrar por: </strong>
    <a th:href="@{/historial(moneda='DOLAR')}">D&oacute;lares (USD)</a> |
    <a th:href="@{/historial(moneda='EURO')}">Euros (EUR)</a> |
    <a th:href="@{/historial}">Ver Todas</a>
  </div>
</header>

<table border="1">
  <thead>
  <tr>
    <th>Moneda</th>
    <th>Cantidad Comprada</th>
    <th>Cotizaci&oacute;n hist&oacute;rica</th>
    <th>Precio Pagado (ARS)</th>
    <th>Fecha de compra</th>
    <th>Ganancia/P&eacute;rdida (ARS)</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="c : ${compras}" class="fila-compra">
    <td th:text="${c.tipoMoneda}"></td>
    <td th:text="${c.cantidadDeDivisasCompradas}" class="cantidad"></td>
    <td th:text="${c.cotizacion}" class="cotizacion-h"></td>
    <td th:text="${c.precioPagado}"></td>
    <td th:text="${c.fechaCompra}"></td>
    <td class="resultado-diferencia">0.00</td>
  </tr>
  </tbody>
</table>

<br>
<a th:href="@{/comprar}">Volver a comprar</a>

<script>
  function calcularDiferencias() {
    // 1. Obtenemos el valor que el usuario escribió en el input
    const cotizacionActual = parseFloat(document.getElementById('cotizacionActual').value) || 0;

    // 2. Obtenemos todas las filas de la tabla
    const filas = document.querySelectorAll('.fila-compra');

    filas.forEach(fila => {
      // 3. Extraemos los valores numéricos de las celdas
      const cantidad = parseFloat(fila.querySelector('.cantidad').innerText);
      const cotizacionHistorica = parseFloat(fila.querySelector('.cotizacion-h').innerText);
      const celdaResultado = fila.querySelector('.resultado-diferencia');

      // 4. Calculamos: (Actual - Histórica) * Cantidad
      const diferencia = (cotizacionActual - cotizacionHistorica) * cantidad;

      // 5. Mostramos el resultado con formato y color
      celdaResultado.innerText = diferencia.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      if (diferencia > 0) {
        celdaResultado.className = 'resultado-diferencia ganancia';
      } else if (diferencia < 0) {
        celdaResultado.className = 'resultado-diferencia perdida';
      } else {
        celdaResultado.className = 'resultado-diferencia';
      }
    });
  }

  // Ejecutar una vez al cargar la página para inicializar los valores
  window.onload = calcularDiferencias;
</script>

</body>
</html>